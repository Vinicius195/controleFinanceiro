// This is an autogenerated file from Firebase Studio.

'use server';

/**
 * @fileOverview Fornece recomendações financeiras com base em dados de receitas e despesas.
 *
 * - getFinancialRecommendations - Uma função que recebe dados de receitas e despesas e retorna recomendações financeiras.
 */

import {ai} from '@/ai/genkit';
import {
  FinancialRecommendationsInput,
  FinancialRecommendationsInputSchema,
  FinancialRecommendationsOutput,
  FinancialRecommendationsOutputSchema,
} from '@/ai/schemas/financial-recommendations';
import {z} from 'zod';

export async function getFinancialRecommendations(
  input: FinancialRecommendationsInput
): Promise<FinancialRecommendationsOutput> {
  return financialRecommendationsFlow(input);
}

const prompt = ai.definePrompt({
  name: 'financialRecommendationsPrompt',
  input: {
    schema: FinancialRecommendationsInputSchema.extend({
      revenueBreakdown: z.string(),
    }),
  },
  output: {schema: FinancialRecommendationsOutputSchema},
  prompt: `Você é um consultor financeiro especialista em pizzarias. Analise os dados financeiros e as receitas de pizza fornecidas para oferecer recomendações práticas e detalhadas para melhorar a lucratividade.

Dados Financeiros:
- Receita: {{{revenue}}} BRL
- Despesas: {{{expenses}}} BRL
- Detalhamento da Receita: {{{revenueBreakdown}}}
- Custos de Ingredientes: {{{ingredientCosts}}} BRL
- Custos com Salários: {{{wageCosts}}} BRL
- Custos com Aluguel: {{{rentCosts}}} BRL

Estratégia e Produtos:
- Estratégia de Preços: {{{pricingStrategy}}}
- Principais Receitas de Pizza: {{{recipes}}}

Com base em todas essas informações, forneça recomendações sobre:
1.  **Otimização de Custos:** Analise os custos de ingredientes em relação às receitas de pizza e ao detalhamento da receita. Sugira substituições ou negociações com fornecedores.
2.  **Estratégia de Preços:** Com base nas receitas e no detalhamento de vendas, avalie se os preços estão adequados. Sugira ajustes, combos ou promoções para os canais ou produtos mais lucrativos.
3.  **Ações Concretas:** Dê exemplos práticos de mudanças que podem ser implementadas para alavancar os pontos fortes identificados no detalhamento da receita.

Responda em português do Brasil, de forma clara e organizada.
`,
  safetySettings: [
    {
      category: 'HARM_CATEGORY_HATE_SPEECH',
      threshold: 'BLOCK_ONLY_HIGH',
    },
    {
      category: 'HARM_CATEGORY_DANGEROUS_CONTENT',
      threshold: 'BLOCK_NONE',
    },
    {
      category: 'HARM_CATEGORY_HARASSMENT',
      threshold: 'BLOCK_MEDIUM_AND_ABOVE',
    },
    {
      category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT',
      threshold: 'BLOCK_LOW_AND_ABOVE',
    },
  ],
});

const financialRecommendationsFlow = ai.defineFlow(
  {
    name: 'financialRecommendationsFlow',
    inputSchema: FinancialRecommendationsInputSchema,
    outputSchema: FinancialRecommendationsOutputSchema,
  },
  async input => {
    const revenueBreakdown = `Vendas no salão: ${input.dineInRevenue} BRL, Vendas por delivery: ${input.deliveryRevenue} BRL, Vendas para retirada: ${input.takeoutRevenue} BRL.`;

    const promptInput = {
      ...input,
      revenueBreakdown,
    };

    const {output} = await prompt(promptInput);
    if (!output) {
      throw new Error(
        'A IA não conseguiu gerar uma recomendação. Verifique os dados e tente novamente.'
      );
    }
    return output;
  }
);
